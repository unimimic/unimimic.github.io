"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[875],{4475:function(e,t,n){n.r(t),n.d(t,{default:function(){return i}});var l=n(8453),a=n(6540);function r(e){const t=Object.assign({h2:"h2",ul:"ul",li:"li",code:"code",a:"a",h3:"h3",ol:"ol",p:"p",pre:"pre",span:"span"},(0,l.R)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.h2,null,"說明"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"使用",a.createElement(t.code,null,"PaddlePaddle"),"平台中的模組**",a.createElement(t.code,null,"PP-OCRv3"),"**作為示範，詳細訓練方法請參閱",a.createElement(t.a,{href:"https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_en/PP-OCRv3_introduction_en.md"},"官方文檔"),"。"),"\n",a.createElement(t.li,null,"以下實作是在windows作業系統，並使用搭配使用 ",a.createElement(t.code,null,"NVIDIA GeForce RTX 2080")," 進行環境建置。"),"\n",a.createElement(t.li,null,"若在訓練過程中有遇到",a.createElement(t.code,null,"numpy"),"問題請搜尋可匹配的版本號，並重新安裝",a.createElement(t.code,null,"numpy"),"。"),"\n"),"\n",a.createElement(t.h2,null,"實作"),"\n",a.createElement(t.h3,null,"建立訓練環境"),"\n",a.createElement(t.ol,null,"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"新建",a.createElement(t.code,null,"conda"),"環境。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"conda create -n ocr python=3.8\nconda activate ocr\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"到",a.createElement(t.a,{href:"https://www.paddlepaddle.org.cn/install/quick?docurl=/documentation/docs/zh/install/pip/windows-pip.html"},"官方"),"點選下載選項選擇與本機匹配的",a.createElement(t.code,null,"Cuda"),"配置，並用產生的指令去安裝",a.createElement(t.code,null,"paddlepaddle-gpu"),"。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"python -m pip install paddlepaddle-gpu==2.3.2.post101 -f https://www.paddlepaddle.org.cn/whl/windows/mkl/avx/stable.html\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"驗證有無成功安裝",a.createElement(t.code,null,"paddlepaddle-gpu"),"。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-python"},"import paddle\npaddle.utils.run_check()\n# 如果有會跳出成功字樣\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"安裝",a.createElement(t.code,null,"PaddleOCR")),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"# Clone PaddleOCR（Inference+training）\ngit clone https://github.com/PaddlePaddle/PaddleOCR\ncd PaddleOCR\npip install -r requirements.txt\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"安裝",a.createElement(t.code,null,"PPOCRLabel")),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"pip install PPOCRLabel\n")),"\n"),"\n"),"\n",a.createElement(t.h3,null,"標註資料"),"\n",a.createElement(t.ol,null,"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"在",a.createElement(t.code,null,"PaddleOCR"),"專案中新增資料夾，資料集結構如下，此範例將訓練集與測試集當作同一個來源。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,".\n└── train_data ── data\n                  ├   ...\n                  ├── image0.jpg\n                  └── image1.jpg\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"啟動標註軟體"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"conda activate ocr\nPPOCRLabel\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"開始標記。標記完成後要存取 ",a.createElement(t.code,null,"Label.txt")," 和 ",a.createElement(t.code,null,"crop_img"),"資料，如下圖綠色區域。"),"\n",a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 303px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/1e40bc0f08135f0127af3fe7dab2da42/6728c/Untitled.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 87.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADyUlEQVR42nVUS28bVRSeLChbNlCpKuxTsacs+ANECvkLqEQtfyANVYjtgJDSCJD4A0is2LAgsaOSRE7aEkr8isdjz9MzfntmPJ4Ze/wIMSRfzx0TCy8Y6dPce+693z3nO+dcbnv7F3y9tYFobAuxaBRRhkgUT558gci/80gkQusxfLW1hcjmJiI0jsWiiNF8c+PLcH1jI4Lvvv0G3Pc/PsfPu8+wH9/D/v4zHB0dYXd3FwcHBzg8PMCvNGbzeDyOvb09HJI9EU8gkUggeXyME0LyOIlkMonfX56AS6TLULp/o9OqwbK7mFxewijrCAZDjAYBVK0MUZRQqVSg6zouad1ut2HoBv65vsb8dw2uWK6j1WyiVBJhGAYkSYLn+/AJvV5vhpu57/fQbLVonxzut20brusi6PdRLBbBiWQ0rSbO81komgJJLsF2bNhdC6Ztzshu0KeDzAFGWKGzTrcb2i8uLnB2dgauangYmkOIKRkNuQ09X4bwSgR/KkDnK3Q7EfWm8HwP/aCPRqMBni+grGlwPW9GmE6nwW3X17DjrGPbWsNT+zF2OuvYsdfxtLOGH5woGm4VgRvAYwc9PwQbszA9zw3HXfJyNBohlUqBu5vm8J6+gLt/cHg3ReAJJwu4o3B4v/sWpL6Ai+EF/AFpGPQwCAao1WrIZkgiRSYP/XkPF3MLuFe9hcXMG1jkCXka84TCLdzj38QH8tu4z9/Gh+Jt3JffwUf2HWS7rzD0RiSBG5IxL2eEnwpL+Ly5gof5FTwqrmC1tIxVfhkPc2TjP8ED8WM8KC7hs/wSVstLeOQsQ/IFjPrjUFeWtDnCP3OkkdNDqSCiohho6C0UsjwMpQqpqEAXK7iaAFd/XWEymODSnyDoBXMlNUf4U7qDSr1OdShAVhVoZZVQhqapEASyUV2Kkkh6qXBcKpGeRyT+/xP+po7QaJlQiYx1g6rK1BEGCV+lQi2hSjatrEGWlbDge/0pwX9rk2V8PB5Ps/w8eURpd4jMQJMKtlathy3Gas2kFms0W2FWW/RnhWxZ9iwRIaE3JZyVzYsXL2GZJs5z0zKQqAULQhEi/Vm4qqqRHCXqZzYXYXccCrM/5+FcyCVVh20RYSaD/HkeGnknUqjFQiF8GDJkV4h0PB4hCAIMBgPUSfMCdYpCF2TTGWRz5+S5Fe7l6vQUmbYVetNumxS+C8dxwjAY2EbH6YY9zBIwoBeoTVJodAmTwjSt0EOm4ZSQ3jqdtMmks6RfDZ1OJyS5AXtN2N8kWRjYmGnM53kIFEWlUg3t7PLT01O8BibKzv78YIYWAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Untitled"\n        title=" "\n        src="/static/1e40bc0f08135f0127af3fe7dab2da42/6728c/Untitled.png"\n        srcset="/static/1e40bc0f08135f0127af3fe7dab2da42/5a46d/Untitled.png 300w,\n/static/1e40bc0f08135f0127af3fe7dab2da42/6728c/Untitled.png 303w"\n        sizes="(max-width: 303px) 100vw, 303px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"最終數據集結構會類似如下。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,".\n└── train_data ── data\n                  ├   ...\n                  ├── image0.jpg\n                  ├── image1.jpg\n                  ├── Label.txt\n                  ├── rec_gt.txt\n                  └── crop_img\n")),"\n"),"\n"),"\n",a.createElement(t.h3,null,"建立 Det 訓練設定"),"\n",a.createElement(t.ol,null,"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_ch/models_list.md"},"點擊此連結"),"。下載預訓練模型。"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"這邊下載",a.createElement(t.code,null,"en_PP-OCRv3_det"),"模型。config檔案參照",a.createElement(t.code,null,"PaddleOCR/configs/det/ch_PP-OCRv3/ch_PP-OCRv3_det_student.yml"),"。"),"\n"),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"配置模型以及config路徑。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,".\n└── pretrain_models ── en_PP-OCRv3_det_distill_train\n\t\t\t                  ├── best_accuracy.pdparams\n\t\t\t                  ├── student.pdparams\n\t\t\t                  └── config.yml\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"調整",a.createElement(t.code,null,"config.yml"),"內容"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-yaml"},"\nGlobal:\n\tpretrained_model: ./pretrain_models/en_PP-OCRv3_det_distill_train/student\n\t\t\t\t.\n\t\t\t\t.\nTrain:\n  dataset:\n    data_dir: ./train_data/\n    label_file_list:\n      - ./train_data/data/Label.txt\n\t\t\t\t.\n\t\t\t\t.\n\tloader:\n\t    **batch_size_per_card: 2**\n\t\t\t\t.\n\t\t\t\t.\nEval:\n  dataset:\n    data_dir: ./train_data/\n    label_file_list:\n      - ./train_data/data/Label.txt\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"執行訓練指令"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-yaml"},"# 沒有checkpoint\npython tools/train.py -c ./pretrain_models/en_PP-OCRv3_det_distill_train/config.yml\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"輸出模型"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},'# 輸出模型\npython tools/export_model.py -c ./pretrain_models/en_PP-OCRv3_det_distill_train/config.yml -o Global.checkpoints="./output/ch_PP-OCR_V3_det/best_accuracy"  Global.load_static_weights=False Global.save_inference_dir="./inference/det/"\n')),"\n"),"\n"),"\n",a.createElement(t.h3,null,"建立 Rec 訓練設定"),"\n",a.createElement(t.ol,null,"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_ch/models_list.md"},"點擊此連結"),"。下載預訓練模型。"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"這邊下載",a.createElement(t.code,null,"en_PP-OCRv3_rec"),"模型。config檔案參照 ",a.createElement(t.code,null,"ch_PP-OCRv3_rec_distillation.yml"),"。"),"\n"),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"配置模型以及config路徑。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,".\n└── pretrain_models ── rec ── en_PP-OCRv3_rec_train\n\t\t\t\t\t\t                  ├── best_accuracy.pdopt\n\t\t\t\t\t\t                  ├── best_accuracy.pdparams\n\t\t\t\t\t\t                  ├── best_accuracy.states\n\t\t\t\t\t\t                  ├── train.log\n\t\t\t\t\t\t                  └── config.yml\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"調整",a.createElement(t.code,null,"config.yml"),"內容"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-yaml"},"Global:\n  pretrained_model: ./pretrain_models/en_PP-OCRv3_rec_train/best_accuracy\n  character_dict_path: ppocr/utils/ic15_dict.txt\n  character_type: en\n  max_text_length: 10\n\t\t\t\t.\n\t\t\t\t.\nArchitecture:\n  Head:\n    head_list:\n      - SARHead:\n          max_text_length: 10\n\t\t\t\t.\n\t\t\t\t.\nTrain:\n  dataset:\n    data_dir: ./train_data/data/\n    label_file_list:\n\t\t- ./train_data/data/rec_gt.txt\n\t\ttransforms:\n\t\t- RecConAug:\n\t\t\tmax_text_length: 10\n\t\t\t\t.\n\t\t\t\t.\n  loader:\n    batch_size_per_card: 2\nEval:\n  dataset:\n    data_dir: ./train_data/data/\n    label_file_list:\n\t\t- ./train_data/data/rec_gt.txt\n\t\t\t\t.\n\t\t\t\t.\n  loader:\n    batch_size_per_card: 1\n    num_workers: 1\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"執行訓練指令"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"# 沒有checkpoint\npython tools/train.py -c ./pretrain_models/en_PP-OCRv3_rec_train/config.yml\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"輸出模型"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},'# 輸出模型\npython tools/export_model.py -c ./pretrain_models/en_PP-OCRv3_rec_train/config.yml -o Global.checkpoints="./output/v3_en_mobile/best_accuracy" Global.save_inference_dir="./inference/rec/"\n')),"\n"),"\n"),"\n",a.createElement(t.h3,null,"Inference with webcam"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-python"},"from paddleocr import PaddleOCR\nimport cv2\nimport numpy as np\n\nocr = PaddleOCR(\n  det_model_dir='./inference/det' ,\n  rec_model_dir = './inference/rec' \n)\n\ncap = cv2.VideoCapture(0)\nwhile(True):\n  _, frame = cap.read()\n  results = ocr.ocr(frame)\n\n  for result in results[0]:\n    pts = np.array(result[0], np.int32).reshape((-1,1,2))\n    cv2.polylines(frame,[pts],True,(0,255,0))\n    cv2.putText(\n      img=frame,\n      text=result[1][0],\n      org=(int(result[0][3][0]),int(result[0][3][1])),\n      fontFace=cv2.FONT_HERSHEY_DUPLEX,\n      fontScale=0.5,\n      color=(0, 0, 255),\n      thickness=1,\n      lineType=cv2.LINE_AA\n    )\n\n  cv2.imshow('frame', frame)\n  if cv2.waitKey(1) & 0xFF == ord('q'):\n    break\n\ncap.release()\ncv2.destroyAllWindows()\n")))}var c=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.R)(),e.components);return t?a.createElement(t,e,a.createElement(r,e)):r(e)},d=n(6543),m=n(454),o=n(9704);const s=e=>{let{data:t,children:n}=e;const{title:r,date:c}=t.allMdx.nodes[0].frontmatter;return a.createElement(d.A,{pageTitle:r},a.createElement(m.Zp,null,a.createElement(m.aR,null,a.createElement(m.ZB,{className:"text-2xl text-center"},r),a.createElement(m.BT,null,c)),a.createElement(m.Wu,null,a.createElement(l.x,{components:o.d},n))))};function i(e){return a.createElement(s,e,a.createElement(c,e))}},9704:function(e,t,n){n.d(t,{d:function(){return a}});var l=n(6540);const a={h1:e=>l.createElement("h1",Object.assign({className:"text-4xl font-semibold mt-8 mb-4 pb-2 border-gray-200 dark:border-gray-700"},e)),h2:e=>l.createElement("h2",Object.assign({className:"text-3xl font-semibold mt-8 mb-4 pb-2 border-gray-200 dark:border-gray-700"},e)),h3:e=>l.createElement("h3",Object.assign({className:"text-2xl font-semibold mt-6 mb-3"},e)),h4:e=>l.createElement("h4",Object.assign({className:"text-xl font-semibold mt-5 mb-2"},e)),h5:e=>l.createElement("h5",Object.assign({className:"text-lg font-semibold mt-4 mb-2"},e)),h6:e=>l.createElement("h6",Object.assign({className:"text-base font-semibold mt-4 mb-2"},e)),p:e=>l.createElement("p",Object.assign({className:"my-4 text-base leading-6 text-gray-800 dark:text-gray-300"},e)),ul:e=>l.createElement("ul",Object.assign({className:"list-disc pl-8 my-4 text-gray-800 dark:text-gray-300"},e)),ol:e=>l.createElement("ol",Object.assign({className:"list-decimal pl-8 my-4 text-gray-800 dark:text-gray-300"},e)),li:e=>l.createElement("li",Object.assign({className:"my-1"},e)),a:e=>l.createElement("a",Object.assign({className:"text-blue-600 hover:underline dark:text-blue-400"},e)),blockquote:e=>l.createElement("blockquote",Object.assign({className:"border-l-4 border-gray-300 dark:border-gray-600 pl-4 text-gray-600 dark:text-gray-400 my-4"},e)),code:e=>l.createElement("code",Object.assign({className:"bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 font-mono text-sm text-gray-800 dark:text-gray-200"},e)),pre:e=>l.createElement("pre",Object.assign({style:{overflowX:"auto"},className:"bg-gray-100 dark:bg-gray-800 rounded-md p-4 my-4 overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200"},e)),table:e=>l.createElement("div",{className:"overflow-x-auto my-4"},l.createElement("table",Object.assign({className:"min-w-full border-collapse border border-gray-300 dark:border-gray-700"},e))),th:e=>l.createElement("th",Object.assign({className:"border border-gray-300 dark:border-gray-700 px-4 py-2 bg-gray-100 dark:bg-gray-800 font-semibold text-left"},e)),td:e=>l.createElement("td",Object.assign({className:"border border-gray-300 dark:border-gray-700 px-4 py-2"},e)),hr:e=>l.createElement("hr",Object.assign({className:"my-8 border-t border-gray-300 dark:border-gray-700"},e)),img:e=>l.createElement("img",Object.assign({className:"max-w-full h-auto rounded-md my-4"},e,{alt:e.alt||""}))}},8453:function(e,t,n){n.d(t,{R:function(){return c},x:function(){return d}});var l=n(6540);const a={},r=l.createContext(a);function c(e){const t=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),l.createElement(r.Provider,{value:t},e.children)}}}]);
//# sourceMappingURL=component---src-templates-blog-post-tsx-content-file-path-content-posts-ocr-paddle-index-md-9da11fda2da504579f4f.js.map