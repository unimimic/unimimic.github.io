"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[988],{3279:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var r=n(8453),a=n(6540);function l(e){const t=Object.assign({h2:"h2",ul:"ul",li:"li",h3:"h3",pre:"pre",code:"code",ol:"ol",p:"p"},(0,r.R)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.h2,null,"說明"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"RPC (Remote Procedure Call) 是一種通信協議，允許一個應用程式在不同的電腦上執行程式並獲取結果，有點像是調用函式的感覺。 通常用於分散式系統中。"),"\n",a.createElement(t.li,null,"gRPC 是一個跨平台的開源遠程調用框架，是由 Google 開發，奠基在 HTTP/2 上提供低延遲 (low latency)，支援串流，更容易做到權限驗證 (authentication)。"),"\n"),"\n",a.createElement(t.h2,null,"實作"),"\n",a.createElement(t.h3,null,"定義 protobuf"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-protobuf"},'// protocal.proto\nsyntax = "proto3"; // 語法版本\n\n// 定義服務\nservice greet{\n    rpc hello (req) returns (res) {} // 定義函式\n    rpc echo  (req) returns (res) {} // 定義函式\n}\n\n// 定義引數格式\nmessage req {\n    string data = 1;\n}\n\n// 定義引數格式\nmessage res {\n    string data = 1;\n}\n')),"\n",a.createElement(t.h3,null,"實作 python"),"\n",a.createElement(t.ol,null,"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"安裝需要的套件"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"pip install grpcio grpcio-tools\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"轉換 proto ，此範例轉換完後會得到",a.createElement(t.code,null,"protocal_pb2_grpc.py")," 和 ",a.createElement(t.code,null,"protocal_pb2.py"),"兩個檔案。"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-bash"},"python -m grpc_tools.protoc -I=./ --python_out=./ --grpc_python_out=./ ./<protocal_filename>.proto\n")),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"實作Sever端"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-python"},'# server.py\nimport grpc\nimport protocal_pb2\nimport protocal_pb2_grpc\nfrom concurrent import futures\n\nclass TestService(protocal_pb2_grpc.greetServicer):\n    def hello(self, request, context):\n        return protocal_pb2.res(data="hellow")\n\n    def echo(self, request, context):\n        return protocal_pb2.res(data=request.data)\n\nif __name__ == \'__main__\':\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    protocal_pb2_grpc.add_greetServicer_to_server(\n        TestService(), server)\n    server.add_insecure_port(\'[::]:50051\')\n    server.start()\n    server.wait_for_termination()\n    print("Listen to", "[::]:50051")\n')),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"實作Client端"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-python"},'# client.py\nimport grpc\nimport protocal_pb2\nimport protocal_pb2_grpc\n\nif __name__ == "__main__":\n    with grpc.insecure_channel("localhost:50051") as channel:\n        stub = protocal_pb2_grpc.greetStub(channel)\n        req = protocal_pb2.req(data="value")\n        print(stub.hello(req).data)\n        print(stub.echo(req).data)\n')),"\n"),"\n",a.createElement(t.li,null,"\n",a.createElement(t.p,null,"啟動服務",a.createElement(t.code,null,"server.py"),"，執行",a.createElement(t.code,null,"client.py"),"程式。回傳hellow以及value。"),"\n"),"\n"))}var c=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,r.R)(),e.components);return t?a.createElement(t,e,a.createElement(l,e)):l(e)},o=n(6543),s=n(454),m=n(9704);const p=e=>{let{data:t,children:n}=e;const{title:l,date:c}=t.allMdx.nodes[0].frontmatter;return a.createElement(o.A,{pageTitle:l},a.createElement(s.Zp,null,a.createElement(s.aR,null,a.createElement(s.ZB,{className:"text-2xl text-center"},l),a.createElement(s.BT,null,c)),a.createElement(s.Wu,null,a.createElement(r.x,{components:m.d},n))))};function u(e){return a.createElement(p,e,a.createElement(c,e))}},9704:function(e,t,n){n.d(t,{d:function(){return a}});var r=n(6540);const a={h1:e=>r.createElement("h1",Object.assign({className:"text-4xl font-semibold mt-8 mb-4 pb-2 border-gray-200 dark:border-gray-700"},e)),h2:e=>r.createElement("h2",Object.assign({className:"text-3xl font-semibold mt-8 mb-4 pb-2 border-gray-200 dark:border-gray-700"},e)),h3:e=>r.createElement("h3",Object.assign({className:"text-2xl font-semibold mt-6 mb-3"},e)),h4:e=>r.createElement("h4",Object.assign({className:"text-xl font-semibold mt-5 mb-2"},e)),h5:e=>r.createElement("h5",Object.assign({className:"text-lg font-semibold mt-4 mb-2"},e)),h6:e=>r.createElement("h6",Object.assign({className:"text-base font-semibold mt-4 mb-2"},e)),p:e=>r.createElement("p",Object.assign({className:"my-4 text-base leading-6 text-gray-800 dark:text-gray-300"},e)),ul:e=>r.createElement("ul",Object.assign({className:"list-disc pl-8 my-4 text-gray-800 dark:text-gray-300"},e)),ol:e=>r.createElement("ol",Object.assign({className:"list-decimal pl-8 my-4 text-gray-800 dark:text-gray-300"},e)),li:e=>r.createElement("li",Object.assign({className:"my-1"},e)),a:e=>r.createElement("a",Object.assign({className:"text-blue-600 hover:underline dark:text-blue-400"},e)),blockquote:e=>r.createElement("blockquote",Object.assign({className:"border-l-4 border-gray-300 dark:border-gray-600 pl-4 text-gray-600 dark:text-gray-400 my-4"},e)),code:e=>r.createElement("code",Object.assign({className:"bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 font-mono text-sm text-gray-800 dark:text-gray-200"},e)),pre:e=>r.createElement("pre",Object.assign({style:{overflowX:"auto"},className:"bg-gray-100 dark:bg-gray-800 rounded-md p-4 my-4 overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200"},e)),table:e=>r.createElement("div",{className:"overflow-x-auto my-4"},r.createElement("table",Object.assign({className:"min-w-full border-collapse border border-gray-300 dark:border-gray-700"},e))),th:e=>r.createElement("th",Object.assign({className:"border border-gray-300 dark:border-gray-700 px-4 py-2 bg-gray-100 dark:bg-gray-800 font-semibold text-left"},e)),td:e=>r.createElement("td",Object.assign({className:"border border-gray-300 dark:border-gray-700 px-4 py-2"},e)),hr:e=>r.createElement("hr",Object.assign({className:"my-8 border-t border-gray-300 dark:border-gray-700"},e)),img:e=>r.createElement("img",Object.assign({className:"max-w-full h-auto rounded-md my-4"},e,{alt:e.alt||""}))}},8453:function(e,t,n){n.d(t,{R:function(){return c},x:function(){return o}});var r=n(6540);const a={},l=r.createContext(a);function c(e){const t=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(l.Provider,{value:t},e.children)}}}]);
//# sourceMappingURL=component---src-templates-blog-post-tsx-content-file-path-content-posts-grpc-index-md-2f12e22789ff52c8b936.js.map